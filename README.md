# Telegram Video Analytics Bot

Telegram-бот для аналитики по видео на основе запросов на естественном языке.  
Бот принимает текстовые запросы, преобразует их в структурированные намерения и возвращает числовые метрики, рассчитанные по данным из PostgreSQL.

---

##  Функциональность

Бот умеет отвечать на запросы вида:
- **Сколько всего просмотров?**
- **Какой прирост просмотров?**
- **Какой прирост просмотров за вчера?**
- **Общее количество лайков**

Ответом всегда является **одно число** (сумма или прирост).

---

##  Используемые технологии

- **Python 3.9**
- **PostgreSQL**
- **SQLAlchemy**
- **aiogram (Telegram Bot API)**
- Rule-based NLP (без генерации SQL)

---

##  Архитектура проекта

Telegram (aiogram)
↓
NLP parser (rule-based)
↓
Query handler
↓
Analytics layer (Python + SQLAlchemy)
↓
PostgreSQL



### Основные принципы:
- NLP-слой **не выполняет вычислений** и **не генерирует SQL**
- Все вычисления выполняются заранее определёнными аналитическими функциями
- Это полностью исключает галлюцинации и некорректные запросы к БД

---

##  Структура данных

### Таблица `videos`
Хранит итоговую статистику по видео:
- `id`
- `creator_id`
- `video_created_at`
- `views_count`
- `likes_count`
- `comments_count`
- `reports_count`
- `created_at`
- `updated_at`

### Таблица `video_snapshots`
Почасовые снапшоты статистики:
- `id`
- `video_id`
- текущие значения (`views_count`, `likes_count`, ...)
- приращения (`delta_views_count`, `delta_likes_count`, ...)
- `created_at`
- `updated_at`

---

##  Обработка запросов на естественном языке

Используется **rule-based парсер**:
- текст запроса приводится к нижнему регистру
- ключевые слова определяют:
  - метрику (`views`, `likes`, `comments`)
  - тип запроса (`total` или `growth`)
  - период (`all`, `today`, `yesterday`)

Результат парсинга — строго структурированный словарь, который затем используется для вызова нужной аналитической функции.

LLM **не используется**, так как все возможные запросы ограничены заранее определённым набором сценариев.

---

  Установка и запуск (локально)

1️⃣ Клонировать репозиторий
```bash
git clone https://github.com/yourusername/telegram-video-analytics-bot.git
cd telegram-video-analytics-bot


2️⃣ Создать и активировать виртуальное окружение

python -m venv venv
venv\Scripts\activate  # Windows

3️⃣ Установить зависимости

pip install -r requirements.txt

Настройка базы данных
1️⃣ Создать базу данных

CREATE DATABASE video_analytics;

2️⃣ Создать таблицы

python -m db.init_db

Загрузка данных из JSON

Для загрузки предоставленного JSON-файла используется скрипт load_data.py
(или данные могут быть загружены аналогичным образом вручную).

Пример запуска:

python load_data.py

Запуск Telegram-бота
1️⃣ Задать токен бота

В файле bot/main.py:

BOT_TOKEN = "YOUR_TELEGRAM_BOT_TOKEN"


(Рекомендуется хранить токен в .env, но для тестового задания допускается прямое указание.)

2️⃣ Запустить бота
python -m bot.main


В терминале появится сообщение:

 Aiogram-бот запущен

✅ Проверка задания

После запуска бота необходимо использовать служебного бота:

@rlt_test_checker_bot


Команда для проверки:

/check @yourbotnickname https://github.com/yourusername/telegram-video-analytics-bot


Важно:

бот должен быть запущен и доступен

репозиторий должен быть публичным

 Примечания

Все ответы бота — строго числовые

В случае нераспознанного запроса бот возвращает 0

Архитектура легко расширяется новыми метриками и периодами

